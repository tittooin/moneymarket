async function fetchNewsJSON(url){try{const res=await fetch(url,{cache:'no-cache'});if(!res.ok)throw new Error('HTTP '+res.status);return await res.json()}catch(e){console.error('News fetch error',e);return null}}
function renderNews(items,container,limit){const list=document.createElement('div');const ordered=items.slice().sort(function(a,b){return (b.image?1:0)-(a.image?1:0)});ordered.slice(0,limit).forEach(function(it){const card=document.createElement('div');card.className='card no-click';if(it.image){const img=document.createElement('img');img.className='thumb';img.src=it.image;img.alt=it.title||'';img.loading='lazy';card.appendChild(img)}const a=document.createElement('a');a.href=it.link;a.textContent=it.title;const p=document.createElement('p');p.textContent=(it.source?it.source+' â€¢ ':'')+(it.pubDate?new Date(it.pubDate).toLocaleString('en-IN'):'');card.appendChild(a);card.appendChild(p);list.appendChild(card)});container.innerHTML='';container.appendChild(list)}
async function initNewsWidgets(){const widgets=document.querySelectorAll('.news-widget');if(!widgets.length)return;const data=await fetchNewsJSON('/assets/data/news.json');if(!data||!data.items||!data.items.length){widgets.forEach(w=>{w.innerHTML='<div class="card no-click"><p>News unavailable. Add feeds in scripts/fetch_news.py and run the updater.</p></div>'});return}widgets.forEach(w=>{const limit=parseInt(w.getAttribute('data-limit')||'6',10);renderNews(data.items,w,limit)})}
document.addEventListener('DOMContentLoaded',initNewsWidgets);
